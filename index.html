<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema do Tribunal do J√∫ri - Cear√°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: #007bff;
            color: white;
        }

        .tab-content {
            display: none;
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #007bff;
        }

        .section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
        }

        .section h3::before {
            content: "üìã";
            margin-right: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #007bff;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #28a745, #1e7e34);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #ffc107, #e0a800);
            color: #212529;
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .jurado-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .jurado-name {
            font-weight: bold;
            color: #2c3e50;
        }

        .checkbox-group {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            transform: scale(1.2);
        }

        .lista-resultado {
            background: white;
            border: 2px solid #007bff;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            min-height: 200px;
        }

        .lista-resultado h4 {
            color: #007bff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .lista-item {
            background: #f0f8ff;
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 3px solid #007bff;
        }

        .resultado-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .condicional {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: #e7f3ff;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }

        .condicional.ativo {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .alert {
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-weight: bold;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.ativo {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #007bff, #0056b3);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .dynamic-field-container {
            margin-bottom: 15px;
        }
        
        .btn-add-field {
            background: #6c757d;
            color: white;
            padding: 8px 15px;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .btn-remove-field {
            background: #dc3545;
            color: white;
            padding: 5px 10px;
            font-size: 0.8em;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öñÔ∏è Sistema do Tribunal do J√∫ri</h1>
            <p>Estado do Cear√°</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="abrirAba('presenca')">üìã Presen√ßa dos Jurados</button>
            <button class="tab" onclick="abrirAba('sorteio')">üé≤ Sorteio do Conselho</button>
            <button class="tab" onclick="abrirAba('ata')">üìÑ Dados da Ata</button>
        </div>

        <div id="presenca" class="tab-content active">
            <div class="section">
                <h3>Configura√ß√£o Inicial</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Comarca:</label>
                        <input type="text" id="comarca" placeholder="Ex: Tau√°, Fortaleza, Juazeiro do Norte...">
                    </div>
                    <div class="form-group">
                        <label>Unidade Judici√°ria:</label>
                        <input type="text" id="unidade-judiciaria" placeholder="Ex: 1¬™ Vara, 2¬™ Vara Criminal...">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Nome do Digitador:</label>
                        <input type="text" id="nome-digitador" placeholder="Seu nome completo">
                    </div>
                    <div class="form-group">
                        <label>Cargo do Digitador:</label>
                        <input type="text" id="cargo-digitador" placeholder="Ex: Diretor de Secretaria, Escrevente...">
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3>Lista de Jurados Convocados</h3>
                <div class="form-group">
                    <label>Digite os nomes dos jurados (um por linha):</label>
                    <textarea id="lista-jurados-input" rows="10" placeholder="Digite um jurado por linha"></textarea>
                </div>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="carregarJurados()">üìã Carregar Jurados</button>
                    <button class="btn btn-primary" onclick="marcarTodos()">‚úÖ Marcar Todos como Presentes</button>
                    <button class="btn btn-warning" onclick="limparTodos()">üîÑ Limpar Sele√ß√µes</button>
                    <button class="btn btn-success" onclick="registrarPresenca()">üíæ Registrar Presen√ßas</button>
                </div>
                <div id="lista-jurados-container"></div>
            </div>
        </div>

        <div id="sorteio" class="tab-content">
            <div class="section">
                <h3>Sorteio do Conselho de Senten√ßa</h3>
                <div style="text-align: center; margin-bottom: 30px;">
                    <button class="btn btn-success" onclick="iniciarSorteio()" style="font-size: 1.3em; padding: 20px 40px;">
                        üé≤ INICIAR SORTEIO DO CONSELHO
                    </button>
                </div>
                
                <div class="resultado-grid">
                    <div class="lista-resultado">
                        <h4>üë• Conselho de Senten√ßa (7 jurados)</h4>
                        <div id="conselho-lista"></div>
                    </div>
                    <div class="lista-resultado">
                        <h4>‚ùå Recusados pela Defesa</h4>
                        <div id="recusados-defesa"></div>
                    </div>
                    <div class="lista-resultado">
                        <h4>‚ùå Recusados pela Acusa√ß√£o</h4>
                        <div id="recusados-acusacao"></div>
                    </div>
                    <div class="lista-resultado">
                        <h4>üö´ Impedidos (Foro √çntimo)</h4>
                        <div id="impedidos-lista"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="ata" class="tab-content">
            <form id="form-ata">
                <div class="section">
                    <h3>Dados B√°sicos da Sess√£o</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>N√∫mero da Sess√£o:</label>
                            <input type="number" id="numero-sessao" placeholder="Ex: 1, 2, 3...">
                        </div>
                        <div class="form-group">
                            <label>Data da Sess√£o:</label>
                            <input type="date" id="data-sessao">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Hora da Sess√£o:</label>
                            <input type="time" id="hora-sessao">
                        </div>
                        <div class="form-group">
                            <label>N√∫mero do Processo:</label>
                            <input type="text" id="numero-processo" placeholder="0000000-00.0000.8.06.0000">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Profissionais Envolvidos</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nome do Juiz:</label>
                            <input type="text" id="nome-juiz" placeholder="Dr. [Nome do Juiz]">
                        </div>
                        <div class="form-group">
                            <label>Nome do Promotor:</label>
                            <input type="text" id="nome-promotor" placeholder="Dr. [Nome do Promotor]">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Tipo de Defensor:</label>
                            <select id="tipo-defensor" onchange="mostrarOAB()">
                                <option value="Defensor P√∫blico">Defensor P√∫blico</option>
                                <option value="Advogado(a)">Advogado(a)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nome do Defensor:</label>
                            <input type="text" id="nome-defensor" placeholder="Nome completo">
                        </div>
                    </div>
                    <div class="form-group condicional" id="campo-oab">
                        <label>OAB/UF:</label>
                        <input type="text" id="oab" placeholder="Ex: 12345/CE">
                    </div>
                    
                    <div class="form-group">
                        <label>Acusado(s):</label>
                        <div id="acusados-container">
                            <div class="dynamic-field-container">
                                <input type="text" class="nome-acusado" placeholder="Nome completo do r√©u">
                            </div>
                        </div>
                        <button type="button" class="btn btn-add-field" onclick="adicionarAcusado()">+ Adicionar outro r√©u</button>
                    </div>
                </div>

                <div class="section">
                    <h3>Dispensas e Suplentes</h3>
                    <div class="form-group">
                        <label>Jurados Dispensados:</label>
                        <textarea id="jurados-dispensados" placeholder="Liste os jurados dispensados, separados por v√≠rgula" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Fundamento da Dispensa:</label>
                        <textarea id="fundamento-dispensa" placeholder="Justificativa legal para as dispensas" rows="2"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Foram sorteados suplentes?</label>
                            <select id="suplentes" onchange="mostrarSuplentes()">
                                <option value="N√£o">N√£o</option>
                                <option value="Sim">Sim</option>
                            </select>
                        </div>
                        <div class="form-group condicional" id="campo-suplentes">
                            <label>Nome(s) dos suplentes:</label>
                            <input type="text" id="nomes-suplentes" placeholder="Nome dos suplentes sorteados">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Testemunhas Dispensadas:</label>
                        <textarea id="testemunhas-dispensadas" placeholder="Testemunhas dispensadas de comum acordo" rows="2"></textarea>
                    </div>
                </div>

                <div class="section">
                    <h3>Instru√ß√£o Plen√°ria</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>H√° v√≠tima a ser ouvida?</label>
                            <select id="ha-vitima" onchange="mostrarVitima()">
                                <option value="N√£o">N√£o</option>
                                <option value="Sim">Sim</option>
                            </select>
                        </div>
                        <div class="form-group condicional" id="campo-vitima">
                            <label>Nome(s) da(s) v√≠tima(s):</label>
                            <input type="text" id="nome-vitima" placeholder="Nome completo da v√≠tima">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>H√° testemunhas/informantes?</label>
                        <select id="ha-testemunhas" onchange="mostrarTestemunhas()">
                            <option value="N√£o">N√£o</option>
                            <option value="Sim">Sim</option>
                        </select>
                    </div>
                    
                    <div class="condicional" id="campos-testemunhas">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Testemunhas da Acusa√ß√£o:</label>
                                <textarea id="testemunhas-acusacao" placeholder="Nome das testemunhas da acusa√ß√£o" rows="2"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Informantes da Acusa√ß√£o:</label>
                                <textarea id="informantes-acusacao" placeholder="Nome dos informantes da acusa√ß√£o" rows="2"></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Testemunhas da Defesa:</label>
                                <textarea id="testemunhas-defesa" placeholder="Nome das testemunhas da defesa" rows="2"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Informantes da Defesa:</label>
                                <textarea id="informantes-defesa" placeholder="Nome dos informantes da defesa" rows="2"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Debates Orais</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Hor√°rio in√≠cio MP:</label>
                            <input type="time" id="hora-mp-inicio">
                        </div>
                        <div class="form-group">
                            <label>Hor√°rio fim MP:</label>
                            <input type="time" id="hora-mp-fim">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Pedido do Minist√©rio P√∫blico:</label>
                        <textarea id="pedido-mp" placeholder="Descreva o pedido do MP (condena√ß√£o, artigos, etc.)" rows="2"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Hor√°rio in√≠cio Defesa:</label>
                            <input type="time" id="hora-defesa-inicio">
                        </div>
                        <div class="form-group">
                            <label>Hor√°rio fim Defesa:</label>
                            <input type="time" id="hora-defesa-fim">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Pedido da Defesa:</label>
                        <textarea id="pedido-defesa" placeholder="Descreva o pedido da defesa (absolvi√ß√£o, desclassifica√ß√£o, etc.)" rows="2"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Houve r√©plica?</label>
                        <select id="houve-replica" onchange="mostrarReplica()">
                            <option value="N√£o">N√£o</option>
                            <option value="Sim">Sim</option>
                        </select>
                    </div>
                    
                    <div class="condicional" id="campos-replica">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Hor√°rio in√≠cio r√©plica:</label>
                                <input type="time" id="hora-replica-inicio">
                            </div>
                            <div class="form-group">
                                <label>Hor√°rio fim r√©plica:</label>
                                <input type="time" id="hora-replica-fim">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Hor√°rio in√≠cio tr√©plica:</label>
                                <input type="time" id="hora-treplica-inicio">
                            </div>
                            <div class="form-group">
                                <label>Hor√°rio fim tr√©plica:</label>
                                <input type="time" id="hora-treplica-fim">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Resultado do Julgamento</h3>
                    <div class="form-group">
                        <label>Resultado:</label>
                        <select id="resultado-julgamento" onchange="atualizarTextoSentenca()">
                            <option value="Condena√ß√£o">Condena√ß√£o</option>
                            <option value="Absolvi√ß√£o">Absolvi√ß√£o</option>
                        </select>
                    </div>
                    <div class="alert alert-success" id="texto-sentenca">
                        Terminada a vota√ß√£o e assinado o termo, o MM. Juiz de Direito determinou a abertura das portas para que o p√∫blico retornasse ao sal√£o do j√∫ri e leu a SENTEN√áA CONDENAT√ìRIA, em voz alta, tornando p√∫blico o julgado.
                    </div>
                    
                    <div class="form-group">
                        <label>Houve manifesta√ß√£o de recurso?</label>
                        <select id="houve-recurso" onchange="mostrarRecurso()">
                            <option value="N√£o">N√£o</option>
                            <option value="Sim">Sim</option>
                        </select>
                    </div>
                    
                    <div class="condicional" id="campos-recurso">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Quem recorreu?</label>
                                <select id="quem-recorreu">
                                    <option value="A Defesa">A Defesa</option>
                                    <option value="A Acusa√ß√£o">A Acusa√ß√£o</option>
                                    <option value="Ambas as partes">Ambas as partes</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Fundamento do recurso:</label>
                                <input type="text" id="fundamento-recurso" placeholder="Ex: art. 593, III, a do CPP" value="art. 593, III, &quot;a&quot; do CPP">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Pr√≥xima Sess√£o</h3>
                    <div class="form-group">
                        <label>Haver√° pr√≥xima sess√£o?</label>
                        <select id="proxima-sessao" onchange="mostrarProximaSessao()">
                            <option value="N√£o">N√£o</option>
                            <option value="Sim">Sim</option>
                        </select>
                    </div>
                    
                    <div class="condicional" id="campos-proxima-sessao">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Data da pr√≥xima sess√£o:</label>
                                <input type="date" id="data-proxima-sessao">
                            </div>
                            <div class="form-group">
                                <label>Hora da pr√≥xima sess√£o:</label>
                                <input type="time" id="hora-proxima-sessao">
                            </div>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; padding: 30px;">
                    <button type="button" class="btn btn-success" onclick="gerarAta()" style="font-size: 1.5em; padding: 20px 50px;">
                        üìÑ GERAR ATA DO J√öRI
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Lista de jurados (ser√° preenchida pelo usu√°rio)
        let jurados = [];
        let presentes = [];
        let ausentes = [];
        let justificadas = [];
        let conselho = [];
        let recusadosDefesa = [];
        let recusadosAcusacao = [];
        let impedidos = [];

        // Inicializar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            // Garante que o texto da senten√ßa inicial esteja correto ao carregar a p√°gina
            atualizarTextoSentenca(); 
        });

        // Fun√ß√£o para abrir abas
        function abrirAba(aba) {
            // Esconder todas as abas
            const abas = document.querySelectorAll('.tab-content');
            abas.forEach(a => a.classList.remove('active'));
            
            const botoes = document.querySelectorAll('.tab');
            botoes.forEach(b => b.classList.remove('active'));
            
            // Mostrar aba selecionada e ativar o bot√£o
            document.getElementById(aba).classList.add('active');
            // 'event.target' se refere ao bot√£o que foi clicado
            event.target.classList.add('active'); 
        }

        // Carregar jurados digitados pelo usu√°rio
        function carregarJurados() {
            const listaInput = document.getElementById('lista-jurados-input').value.trim();
            if (!listaInput) {
                alert('Por favor, digite os nomes dos jurados convocados.');
                return;
            }
            
            jurados = listaInput.split('\n').filter(nome => nome.trim() !== '');
            criarListaJurados();
            alert(`Foram carregados ${jurados.length} jurados na lista.`);
        }

        // Criar lista de jurados
        function criarListaJurados() {
            const container = document.getElementById('lista-jurados-container');
            container.innerHTML = '';
            
            jurados.forEach((jurado, index) => {
                const item = document.createElement('div');
                item.className = 'jurado-item';
                item.innerHTML = `
                    <div class="jurado-name">${jurado}</div>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="presente-${index}" onchange="atualizarCheckboxes(${index}, 'presente')">
                            <label for="presente-${index}">Presente</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="justificada-${index}" onchange="atualizarCheckboxes(${index}, 'justificada')">
                            <label for="justificada-${index}">Aus√™ncia Justificada</label>
                        </div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        // Adicionar campo para outro r√©u
        function adicionarAcusado() {
            const container = document.getElementById('acusados-container');
            const div = document.createElement('div');
            div.className = 'dynamic-field-container';
            div.innerHTML = `
                <input type="text" class="nome-acusado" placeholder="Nome completo do r√©u">
                <button type="button" class="btn-remove-field" onclick="this.parentElement.remove()">Remover</button>
            `;
            container.appendChild(div);
        }

        // Obter lista de r√©us
        function obterAcusados() {
            const inputs = document.querySelectorAll('.nome-acusado');
            const nomes = Array.from(inputs).map(input => input.value.trim()).filter(nome => nome !== '');
            return nomes.length > 0 ? nomes.join(', ') : '________';
        }

        // Atualizar checkboxes (s√≥ um pode estar marcado por jurado)
        function atualizarCheckboxes(index, tipo) {
            if (tipo === 'presente') {
                if (document.getElementById(`presente-${index}`).checked) {
                    document.getElementById(`justificada-${index}`).checked = false;
                }
            } else if (tipo === 'justificada') {
                if (document.getElementById(`justificada-${index}`).checked) {
                    document.getElementById(`presente-${index}`).checked = false;
                }
            }
        }

        // Marcar todos como presentes
        function marcarTodos() {
            if (jurados.length === 0) {
                alert('Primeiro carregue a lista de jurados.');
                return;
            }
            
            jurados.forEach((_, index) => {
                document.getElementById(`presente-${index}`).checked = true;
                document.getElementById(`justificada-${index}`).checked = false;
            });
        }

        // Limpar todas as sele√ß√µes
        function limparTodos() {
            if (jurados.length === 0) {
                alert('Primeiro carregue a lista de jurados.');
                return;
            }
            
            jurados.forEach((_, index) => {
                document.getElementById(`presente-${index}`).checked = false;
                document.getElementById(`justificada-${index}`).checked = false;
            });
        }

        // Registrar presen√ßa
        function registrarPresenca() {
            if (jurados.length === 0) {
                alert('Primeiro carregue a lista de jurados.');
                return;
            }
            
            presentes = [];
            ausentes = [];
            justificadas = [];
            
            jurados.forEach((jurado, index) => {
                const presente = document.getElementById(`presente-${index}`).checked;
                const justificada = document.getElementById(`justificada-${index}`).checked;
                
                if (presente) {
                    presentes.push(jurado);
                } else if (justificada) {
                    ausentes.push(jurado);
                    justificadas.push(jurado);
                } else {
                    ausentes.push(jurado);
                }
            });
            
            alert(`‚úÖ Presen√ßa registrada!\n\nüìã Presentes: ${presentes.length}\n‚ùå Ausentes: ${ausentes.length}\nüìù Justificadas: ${justificadas.length}`);
        }

        // Iniciar sorteio
        function iniciarSorteio() {
            if (presentes.length === 0) {
                alert('‚ö†Ô∏è Primeiro registre a presen√ßa dos jurados na aba anterior!');
                return;
            }
            
            if (presentes.length < 7) {
                alert('‚ö†Ô∏è N√£o h√° jurados suficientes para formar o conselho (m√≠nimo 7)!');
                return;
            }
            
            // Resetar listas
            conselho = [];
            recusadosDefesa = [];
            recusadosAcusacao = [];
            impedidos = [];
            
            let recusasDefesa = 3;
            let recusasAcusacao = 3;
            let listaPresentes = [...presentes]; // Copia a lista de presentes para n√£o modificar a original
            
            // Sorteio autom√°tico
            while (conselho.length < 7 && listaPresentes.length > 0) {
                const indiceAleatorio = Math.floor(Math.random() * listaPresentes.length);
                const juradoSorteado = listaPresentes[indiceAleatorio];
                
                const aceitar = confirm(`üé≤ Jurado sorteado: ${juradoSorteado}\n\n‚úÖ Clique OK para ACEITAR no conselho\n‚ùå Clique CANCELAR para RECUSAR`);
                
                if (aceitar) {
                    conselho.push(juradoSorteado);
                } else {
                    const tipoRecusa = prompt(`‚ùå Recusa do jurado: ${juradoSorteado}\n\nDigite:\n1 - Recusa pela DEFESA\n2 - Recusa pela ACUSA√á√ÉO\n3 - Impedimento (Foro √çntimo)`);
                    
                    if (tipoRecusa === '1') {
                        if (recusasDefesa > 0) {
                            recusadosDefesa.push(juradoSorteado);
                            recusasDefesa--;
                        } else {
                            alert('‚ö†Ô∏è Limite de recusas pela Defesa atingido! Jurado ser√° aceito automaticamente.');
                            conselho.push(juradoSorteado);
                        }
                    } else if (tipoRecusa === '2') {
                        if (recusasAcusacao > 0) {
                            recusadosAcusacao.push(juradoSorteado);
                            recusasAcusacao--;
                        } else {
                            alert('‚ö†Ô∏è Limite de recusas pela Acusa√ß√£o atingido! Jurado ser√° aceito automaticamente.');
                            conselho.push(juradoSorteado);
                        }
                    } else if (tipoRecusa === '3') {
                        impedidos.push(juradoSorteado);
                    } else {
                        alert('‚ö†Ô∏è Op√ß√£o inv√°lida! Jurado ser√° aceito automaticamente.');
                        conselho.push(juradoSorteado);
                    }
                }
                
                listaPresentes.splice(indiceAleatorio, 1); // Remove o jurado sorteado da lista de dispon√≠veis
            }
            
            atualizarListasResultado();
            
            if (conselho.length === 7) {
                alert('üéâ Conselho de Senten√ßa formado com sucesso!\n\nüë• 7 jurados sorteados e aceitos.');
            } else {
                alert('‚ö†Ô∏è N√£o foi poss√≠vel formar o conselho completo devido ao n√∫mero insuficiente de jurados.');
            }
        }

        // Atualizar listas de resultado
        function atualizarListasResultado() {
            document.getElementById('conselho-lista').innerHTML = conselho.map((j, i) => 
                `<div class="lista-item">${i + 1}. ${j}</div>`
            ).join('');
            
            document.getElementById('recusados-defesa').innerHTML = recusadosDefesa.length > 0 
                ? recusadosDefesa.map(j => `<div class="lista-item">${j}</div>`).join('')
                : '<div style="color: #6c757d; font-style: italic;">Nenhum jurado recusado</div>';
                
            document.getElementById('recusados-acusacao').innerHTML = recusadosAcusacao.length > 0 
                ? recusadosAcusacao.map(j => `<div class="lista-item">${j}</div>`).join('')
                : '<div style="color: #6c757d; font-style: italic;">Nenhum jurado recusado</div>';
                
            document.getElementById('impedidos-lista').innerHTML = impedidos.length > 0 
                ? impedidos.map(j => `<div class="lista-item">${j}</div>`).join('')
                : '<div style="color: #6c757d; font-style: italic;">Nenhum jurado impedido</div>';
        }

        // Fun√ß√µes para mostrar/ocultar campos condicionais
        function mostrarOAB() {
            const campo = document.getElementById('campo-oab');
            const tipo = document.getElementById('tipo-defensor').value;
            campo.classList.toggle('ativo', tipo === 'Advogado(a)');
        }

        function mostrarSuplentes() {
            const campo = document.getElementById('campo-suplentes');
            const valor = document.getElementById('suplentes').value;
            campo.classList.toggle('ativo', valor === 'Sim');
        }

        function mostrarVitima() {
            const campo = document.getElementById('campo-vitima');
            const valor = document.getElementById('ha-vitima').value;
            campo.classList.toggle('ativo', valor === 'Sim');
        }

        function mostrarTestemunhas() {
            const campo = document.getElementById('campos-testemunhas');
            const valor = document.getElementById('ha-testemunhas').value;
            campo.classList.toggle('ativo', valor === 'Sim');
        }

        function mostrarDiligencia() {
            const campo = document.getElementById('campos-diligencia');
            const valor = document.getElementById('ha-diligencia').value;
            campo.classList.toggle('ativo', valor === 'Sim');
        }

        function mostrarReplica() {
            const campo = document.getElementById('campos-replica');
            const valor = document.getElementById('houve-replica').value;
            campo.classList.toggle('ativo', valor === 'Sim');
        }

        function mostrarRecurso() {
            const campo = document.getElementById('campos-recurso');
            const valor = document.getElementById('houve-recurso').value;
            campo.classList.toggle('ativo', valor === 'Sim');
        }

        function mostrarProximaSessao() {
            const campo = document.getElementById('campos-proxima-sessao');
            const valor = document.getElementById('proxima-sessao').value;
            campo.classList.toggle('ativo', valor === 'Sim');
        }

        function atualizarTextoSentenca() {
            const resultado = document.getElementById('resultado-julgamento').value;
            const texto = document.getElementById('texto-sentenca');
            
            if (resultado === 'Absolvi√ß√£o') {
                texto.innerHTML = 'Terminada a vota√ß√£o e assinado o termo, o MM. Juiz de Direito determinou a abertura das portas para que o p√∫blico retornasse ao sal√£o do j√∫ri e leu a <strong>SENTEN√áA ABSOLUT√ìRIA</strong>, em voz alta, tornando p√∫blico o julgado.';
            } else {
                texto.innerHTML = 'Terminada a vota√ß√£o e assinado o termo, o MM. Juiz de Direito determinou a abertura das portas para que o p√∫blico retornasse ao sal√£o do j√∫ri e leu a <strong>SENTEN√áA CONDENAT√ìRIA</strong>, em voz alta, tornando p√∫blico o julgado.';
            }
        }

        // Fun√ß√£o para formatar hora
        function formatarHora(hora) {
            if (!hora) return '';
            const [h, m] = hora.split(':');
            const hInt = parseInt(h);
            const mInt = parseInt(m);
            if (mInt === 0) {
                return `${hInt}h`;
            } else {
                return `${hInt}h${mInt.toString().padStart(2, '0')}min`;
            }
        }

        // Fun√ß√£o para formatar data
        function formatarData(data) {
            if (!data) return '';
            const [ano, mes, dia] = data.split('-');
            return `${dia}/${mes}/${ano}`;
        }

        // Fun√ß√£o para gerar a ata
        function gerarAta() {
            // Valida√ß√µes b√°sicas
            const comarca = document.getElementById('comarca').value.trim();
            const unidadeJudiciaria = document.getElementById('unidade-judiciaria').value.trim();
            const digitador = document.getElementById('nome-digitador').value.trim();
            const cargoDigitador = document.getElementById('cargo-digitador').value.trim();
            
            if (!comarca) {
                alert('Por favor, informe a comarca.');
                return;
            }
            
            if (!unidadeJudiciaria) {
                alert('Por favor, informe a unidade judici√°ria.');
                return;
            }
            
            if (!digitador) {
                alert('Por favor, informe o nome do digitador.');
                return;
            }
            
            if (!cargoDigitador) {
                alert('Por favor, informe o cargo do digitador.');
                return;
            }
            
            const numeroProcesso = document.getElementById('numero-processo').value.trim();
            if (!numeroProcesso || !/^\d{7}-\d{2}\.\d{4}\.8\.06\.\d{4}$/.test(numeroProcesso)) {
                alert('‚ùå N√∫mero de processo inv√°lido ou n√£o preenchido!\nFormato: 0000000-00.0000.8.06.0000');
                return;
            }

            if (conselho.length === 0) {
                alert('‚ùå Realize o sorteio do conselho antes de gerar a ata!');
                return;
            }

            // Coletar dados do formul√°rio
            const dados = {
                comarca: comarca,
                unidadeJudiciaria: unidadeJudiciaria,
                digitador: digitador,
                cargoDigitador: cargoDigitador,
                numeroSessao: document.getElementById('numero-sessao').value,
                dataSessao: formatarData(document.getElementById('data-sessao').value),
                horaSessao: formatarHora(document.getElementById('hora-sessao').value),
                numeroProcesso: numeroProcesso,
                nomeJuiz: document.getElementById('nome-juiz').value,
                nomePromotor: document.getElementById('nome-promotor').value,
                tipoDefensor: document.getElementById('tipo-defensor').value,
                nomeDefensor: document.getElementById('nome-defensor').value,
                oab: document.getElementById('oab').value,
                nomeAcusados: obterAcusados(),
                juradosDispensados: document.getElementById('jurados-dispensados').value,
                fundamentoDispensa: document.getElementById('fundamento-dispensa').value,
                suplentes: document.getElementById('suplentes').value,
                nomesSuplentes: document.getElementById('nomes-suplentes').value,
                testemunhasDispensadas: document.getElementById('testemunhas-dispensadas').value,
                haVitima: document.getElementById('ha-vitima').value,
                nomeVitima: document.getElementById('nome-vitima').value,
                haTestemunhas: document.getElementById('ha-testemunhas').value,
                testemunhasAcusacao: document.getElementById('testemunhas-acusacao').value,
                informantesAcusacao: document.getElementById('informantes-acusacao').value,
                testemunhasDefesa: document.getElementById('testemunhas-defesa').value,
                informantesDefesa: document.getElementById('informantes-defesa').value,
                haDiligencia: document.getElementById('ha-diligencia').value,
                qualDiligencia: document.getElementById('qual-diligencia').value,
                diligenciaDeferida: document.getElementById('diligencia-deferida').value,
                fundamentoDiligencia: document.getElementById('fundamento-diligencia').value,
                horaMpInicio: formatarHora(document.getElementById('hora-mp-inicio').value),
                horaMpFim: formatarHora(document.getElementById('hora-mp-fim').value),
                pedidoMp: document.getElementById('pedido-mp').value,
                horaDefesaInicio: formatarHora(document.getElementById('hora-defesa-inicio').value),
                horaDefesaFim: formatarHora(document.getElementById('hora-defesa-fim').value),
                pedidoDefesa: document.getElementById('pedido-defesa').value,
                houveReplica: document.getElementById('houve-replica').value,
                horaReplicaInicio: formatarHora(document.getElementById('hora-replica-inicio').value),
                horaReplicaFim: formatarHora(document.getElementById('hora-replica-fim').value),
                horaTriplicaInicio: formatarHora(document.getElementById('hora-treplica-inicio').value),
                horaTriplicaFim: formatarHora(document.getElementById('hora-treplica-fim').value),
                resultadoJulgamento: document.getElementById('resultado-julgamento').value,
                houveRecurso: document.getElementById('houve-recurso').value,
                quemRecorreu: document.getElementById('quem-recorreu').value,
                fundamentoRecurso: document.getElementById('fundamento-recurso').value,
                proximaSessao: document.getElementById('proxima-sessao').value,
                dataProximaSessao: formatarData(document.getElementById('data-proxima-sessao').value),
                horaProximaSessao: formatarHora(document.getElementById('hora-proxima-sessao').value)
            };

            function gerarAta() {
    // Valida√ß√µes b√°sicas (mantenha as que j√° existem no seu c√≥digo)
    const comarca = document.getElementById('comarca').value.trim();
    const unidadeJudiciaria = document.getElementById('unidade-judiciaria').value.trim();
    const digitador = document.getElementById('nome-digitador').value.trim();
    const cargoDigitador = document.getElementById('cargo-digitador').value.trim();
    
    if (!comarca || !unidadeJudiciaria || !digitador || !cargoDigitador) {
        alert('Por favor, preencha todos os campos obrigat√≥rios na se√ß√£o "Configura√ß√£o Inicial".');
        return;
    }
    
    const numeroProcesso = document.getElementById('numero-processo').value.trim();
    if (!numeroProcesso || !/^\d{7}-\d{2}\.\d{4}\.8\.06\.\d{4}$/.test(numeroProcesso)) {
        alert('‚ùå N√∫mero de processo inv√°lido ou n√£o preenchido!\nFormato: 0000000-00.0000.8.06.0000');
        return;
    }

    if (conselho.length === 0) {
        alert('‚ùå Realize o sorteio do conselho antes de gerar a ata!');
        return;
    }

    // ... (mantenha todo o c√≥digo de constru√ß√£o da ata que j√° existe)
    // N√£o altere a parte que coleta os dados e constr√≥i o texto da ata

    // --- C√ìDIGO NOVO PARA DOWNLOAD (SUBSTITUA APENAS ESTA PARTE FINAL) ---
    const textoCompleto = ata.join('\n\n');
    
    try {
        // 1. Cria o blob (arquivo em mem√≥ria) com codifica√ß√£o UTF-8
        const blob = new Blob(["\uFEFF" + textoCompleto], {
            type: 'text/plain;charset=utf-8'
        });

        // 2. Cria um link tempor√°rio para download
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        
        // 3. Define o nome do arquivo (substitui caracteres problem√°ticos)
        link.download = `ATA_JURI_${numeroProcesso.replace(/[\/\.]/g, '_')}.txt`;
        
        // 4. Adiciona o link na p√°gina e simula o clique
        document.body.appendChild(link);
        link.click();
        
        // 5. Limpeza: remove o link ap√≥s 100ms
        setTimeout(() => {
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
        }, 100);
        
        alert('‚úÖ Ata gerada com sucesso!\nO download come√ßar√° automaticamente.');
        
    } catch (error) {
        console.error("Erro ao gerar arquivo:", error);
        // Fallback: abre o conte√∫do em nova janela se o download falhar
        const win = window.open('', '_blank');
        win.document.write('<pre>' + textoCompleto + '</pre>');
        win.document.title = 'ATA_JURI - Copiar Manualmente';
        win.document.close();
        alert('‚ö†Ô∏è O navegador bloqueou o download autom√°tico.\nO conte√∫do foi aberto em nova janela para copiar manualmente.');
    }
}
